/** FCBKcomplete v2.8.9.1 is released under the MIT License <http://www.opensource.org/licenses/mit-license.php> */
(function(a,b){a.fn.fcbkcomplete=function(b){return this.queue(function(){function c(){d(),h(0)}function d(){z=a('<ul class="holder"></ul>').width(y.width),y.attachto?typeof y.attachto=="object"?y.attachto.append(z):a(y.attachto).append(z):H.after(z),B=a('<div class="facebook-auto">').width(y.width);if(y.complete_text!=""){var b=y.complete_text;B.append('<div class="default">'+b+"</div>"),y.select_all_text&&B.children(".default").append(a('<a href="" class="select_all_items">'+y.select_all_text+"</a>").click(function(){return a(H).trigger("selectAll"),!1}))}B.hover(function(){G=0},function(){G=1}),A=a('<ul id="'+I+'_feed"></ul>').width(y.width),z.after(B.prepend(A)),e()}function e(){name=H.attr("name"),y.bricket&&name.indexOf("[]")==-1&&(name=name+"[]");var b=a("<"+H.get(0).tagName+' name="'+name+'" id="'+I+'" multiple="multiple" class="'+H.get(0).className+' hidden">').data("cache",{});a.each(H.children("option"),function(c,d){d=a(d),b.data("cache")[d.val()]=d.text();if(d.hasClass("selected")){var e=f(d.text(),d.val(),!0,d.hasClass("locked"));b.append('<option value="'+d.val()+'" selected="selected" id="opt_'+e+'"class="selected">'+d.text()+"</option>")}}),H.after(b),H.remove(),H=b,a(H).bind("addItem",function(a,b){f(b.title,b.value,0,0,0)}),a(H).bind("removeItem",function(a,b){var c=z.children("li[rel="+b.value+"]");c.length&&g(c)}),a(H).bind("destroy",function(a,b){z.remove(),B.remove(),H.show()}),a(H).bind("selectAll",function(b,c){var d=a(H).val();a.each(a(H).data("cache"),function(b,c){a.inArray(b,a(H).val())===-1&&f(c,b,0,0,0)}),A.parent().hide()})}function f(b,c,d,e,f){if(!q())return!1;var i="bit-box"+(e?" locked":""),j=M(),k=document.createTextNode(v(b)),l=a('<a class="closebutton" href="#"></a>'),m=a('<li class="'+i+'" rel="'+c+'" id="pt_'+j+'"></li>').prepend(k).append(l);z.append(m),l.click(function(){return g(a(this).parent("li")),!1});if(!d){a("#"+I+"_annoninput").remove(),h(f);var n=a('<option value="'+v(c,1)+'" id="opt_'+j+'" class="selected" selected="selected">'+v(b)+"</option>");H.append(n),y.onselect&&s(y.onselect,n),H.change()}return z.children("li.bit-box.deleted").removeClass("deleted"),w(1),j}function g(b){if(!b.hasClass("locked")){b.fadeOut("fast");var c=b.attr("id");if(y.onremove){var d=c?a("#o"+c+""):H.children("option[value="+b.attr("rel")+"]");s(y.onremove,d)}c?a("#o"+c+"").remove():H.children('option[value="'+b.attr("rel")+'"]').remove(),b.remove(),H.change(),F=0}}function h(b){var c=a('<li class="bit-input" id="'+I+'_annoninput">'),d=a('<input type="text" class="maininput" size="'+y.input_min_size+'" autocomplete="off">');y.input_tabindex>0&&d.attr("tabindex",y.input_tabindex),y.input_name!=""&&d.attr("name",y.input_name),z.append(c.append(d)),d.focus(function(){D=!0,q()&&B.fadeIn("fast")}),d.blur(function(){D=!1,G?B.fadeOut("fast"):d.focus()}),z.click(function(){y.input_min_size<0&&A.length&&x(u(d.val(),1)),d.focus(),A.length&&d.val().length>y.input_min_size?A.show():(w(1),B.children(".default").show())}),d.keypress(function(a){if(a.keyCode==L.enter)return!1;var b=d.val().length+1;y.input_min_size>b&&(b=y.input_min_size),d.attr("size",b)}),d.keyup(function(b){var c=u(d.val(),1);if(b.keyCode==L.backspace&&c.length==0){w(1);if(!z.children("li.bit-box:last").hasClass("locked")){if(z.children("li.bit-box.deleted").length==0)return z.children("li.bit-box:last").addClass("deleted"),!1;if(F)return;F=1,z.children("li.bit-box.deleted").fadeOut("fast",function(){return g(a(this)),!1})}}b.keyCode!=L.downarrow&&b.keyCode!=L.uparrow&&b.keyCode!=L.leftarrow&&b.keyCode!=L.rightarrow&&c.length>y.input_min_size&&(x(c),B.children(".default").hide(),A.show())}),y.oncreate&&s(y.oncreate,d),b&&setTimeout(function(){d.focus(),B.children(".default").show()},1)}function j(b,c){A.html(""),!y.cache&&c!=null&&N.clear(),r(b),c!=null&&c.length&&a.each(c,function(a,b){N.set(u(b.key),u(b.value))});var d=y.maxshownitems<N.length()?y.maxshownitems:N.length(),e="";a.each(N.search(b),function(a,c){if(!y.filter_selected||!H.children("option[value="+c.key+"]").hasClass("selected"))e+='<li rel="'+c.key+'">'+v(k(c.value,b))+"</li>",C++,d--}),A.append(e),y.firstselected&&(E=A.children("li:visible:first"),E.addClass("auto-focus")),C>y.height?A.css({height:y.height*24+"px",overflow:"auto"}):A.css("height","auto"),q()&&B.is(":hidden")&&B.show()}function k(a,b){var c=y.filter_begin?"":"(.*)",d=y.filter_begin?"<em>$1</em>$2":"$1<em>$2</em>$3",e=c+(y.filter_case?"("+b+")(.*)":"("+b.toLowerCase()+")(.*)");try{var f=new RegExp(e,y.filter_case?"g":"gi"),a=a.replace(f,d)}catch(g){}return a}function l(){A.children("li").mouseover(function(){A.children("li").removeClass("auto-focus"),E=a(this),E.addClass("auto-focus")}),A.children("li").mouseout(function(){a(this).removeClass("auto-focus"),E=null})}function m(){A.unbind("mouseover").unbind("mouseout").mousemove(function(){l(),A.unbind("mousemove")})}function n(){var b=a("#"+I+"_annoninput").children(".maininput");l(),A.children("li").unbind("mousedown").mousedown(function(){var b=a(this);f(b.text(),b.attr("rel"),0,0,1),w(1),B.hide()}),b.unbind("keydown"),b.keydown(function(b){b.keyCode!=L.backspace&&z.children("li.bit-box.deleted").removeClass("deleted");if(!(b.keyCode!=L.enter&&b.keyCode!=L.tab||!t())){var c=E;return f(c.text(),c.attr("rel"),0,0,1),p(b)}if((b.keyCode==L.enter||b.keyCode==L.tab)&&!t()){if(y.newel){var d=u(a(this).val());return f(d,d,0,0,1),p(b)}if(y.addontab&&y.newel){E=A.children("li:visible:first");var c=E;return f(c.text(),c.attr("rel"),0,0,1),p(b)}}b.keyCode==L.downarrow&&o("first"),b.keyCode==L.uparrow&&o("last")})}function o(a){m();if(E==null||E.length==0)E=A.children("li:visible:"+a),A.get(0).scrollTop=a=="first"?0:parseInt(E.get(0).scrollHeight,10)*(parseInt(A.children("li:visible").length,10)-Math.round(y.height/2));else{E.removeClass("auto-focus"),E=a=="first"?E.nextAll("li:visible:first"):E.prevAll("li:visible:first");var b=parseInt(E.prevAll("li:visible").length,10),c=parseInt(E.nextAll("li:visible").length,10);((a=="first"?b:c)>Math.round(y.height/2)||(a=="first"?b:c)<=Math.round(y.height/2))&&typeof E.get(0)!="undefined"&&(A.get(0).scrollTop=parseInt(E.get(0).scrollHeight,10)*(b-Math.round(y.height/2)))}A.children("li").removeClass("auto-focus"),E.addClass("auto-focus")}function p(a){return B.hide(),a.preventDefault(),E=null,!1}function q(){return y.maxitems!=0&&z.children("li.bit-box").length<y.maxitems}function r(b){if(y.newel&&q()){A.children("li[fckb=1]").remove();if(b.length==0)return;var c=a('<li rel="'+b+'" fckb="1">').html(v(b));A.prepend(c),C++}return}function s(a,b){var c={};for(i=0;i<b.get(0).attributes.length;i++)b.get(0).attributes[i].nodeValue!=null&&(c["_"+b.get(0).attributes[i].nodeName]=b.get(0).attributes[i].nodeValue);return a.call(a,c)}function t(){return E==null||E.length==0?!1:!0}function u(a,b){if(typeof b!="undefined"){for(i=0;i<a.length;i++){var c=a.charCodeAt(i);if(L.exclamation<=c&&c<=L.slash||L.colon<=c&&c<=L.at||L.squarebricket_left<=c&&c<=L.apostrof)a=a.replace(a[i],escape(a[i]))}a=a.replace(/(\{|\}|\*)/i,"\\$1")}return a.replace(/script(.*)/g,"")}function v(a,b){return a=a.toString(),a=a.replace("\\",""),typeof b!="undefined"?a:unescape(a)}function w(a){A.children().remove(),a&&A.hide()}function x(b){C=0;if(y.json_url&&q())if(y.cache&&K.get(b))j(b),n();else{J++;var c=J;setTimeout(function(){if(c!=J)return;a.getJSON(y.json_url,{tag:v(b)},function(a){if(!D)return;j(b,a),K.set(b,1),n()})},y.delay)}else j(b),n()}var y=a.extend({json_url:null,width:512,cache:!1,height:"10",newel:!1,addontab:!1,firstselected:!1,filter_case:!1,filter_selected:!1,filter_begin:!1,complete_text:"Start to type...",select_all_text:null,maxshownitems:30,maxitems:10,oncreate:null,onselect:null,onremove:null,attachto:null,delay:350,input_tabindex:0,input_min_size:1,input_name:"",bricket:!0},b),z=null,A=null,B=null,C=0,D=!1,E=null,F=0,G=1,H=a(this),I=H.attr("id"),J=0,K={set:function(a,b){var c=H.data("jsoncache");c[a]=b,H.data("jsoncache",c)},get:function(a){return H.data("jsoncache")[a]!="undefined"?H.data("jsoncache")[a]:null},init:function(){H.data("jsoncache",{})}},L={enter:13,tab:9,backspace:8,leftarrow:37,uparrow:38,rightarrow:39,downarrow:40,exclamation:33,slash:47,colon:58,at:64,squarebricket_left:91,apostrof:96},M=function(){var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",b="";for(var c=0;c<32;c++){var d=Math.floor(Math.random()*a.length);b+=a.substring(d,d+1)}return b},N={search:function(b,c){var d=[],e=new RegExp((y.filter_begin?"^":"")+b,y.filter_case?"g":"gi");return a.each(H.data("cache"),function(a,b){typeof b.search=="function"&&b.search(e)!=-1&&d.push({key:a,value:b})}),d},set:function(a,b){var c=H.data("cache");c[a]=b,H.data("cache",c)},get:function(a){return H.data("cache")[a]!="undefined"?H.data("cache")[a]:null},clear:function(){H.data("cache",{})},length:function(){return H.data("cache").length},init:function(){H.data("cache")=="undefined"&&H.data("cache",{})}};return c(),K.init(),N.init(),this})}})(jQuery)