%h1 New Translation

= form_for @word do |f|
  = f.hidden_field :lang
  = hidden_field_tag :step, 1

  #polish{ lang: 'pl' }

  #german.hidden{ lang: 'de' }
  #english.hidden{ lang: 'en' }

  .actions
    %input.prev.secondary.hidden{ type: 'button', value: 'Back' }
    %input.next.primary{ type: 'button', value: 'Continue' }

    = f.submit 'Create', class: 'hidden primary'

:javascript
  $(function() {
    $('#polish').languageBox({ sourceUrl: '#{autocomplete_words_path}', textareaNameFormat: 'word[name]', word: '#{@word.name}' });
    $("#polish textarea").focus()
  });

:coffeescript
  $ () ->
    $('#german, #english').languageBox { sourceUrl: '#{autocomplete_words_path}' }

    steps =
      range:
        min: 1
        max: 3

      step:
        get: () -> Number $("#step").val()
        set: (step) -> $("#step").val step

      next: (@element) ->
        step = @step.get()

        if step < @range.max
          @findPrevButton().removeClass('hidden')
          @findCurrentBox().addClass('hidden')
          @findNextBox().removeClass('hidden').find('textarea').focus()

          @step.set step + 1

        if step + 1 >= @range.max
          @element.addClass('hidden')
          @findSubmitButton().removeClass('hidden')

      prev: (@element) ->
        step = @step.get()

        if step > @range.min
          @findCurrentBox().addClass('hidden')
          @findPrevBox().removeClass('hidden').find('textarea').focus()
          @findNextButton().removeClass('hidden')
          @findSubmitButton().addClass('hidden')

          @step.set step - 1

        if step - 1 <= @range.min
          @element.addClass('hidden')

      findCurrentBox: () ->
        $ @findBoxes()[@step.get() - 1]

      findPrevBox: () ->
        $ @findBoxes()[@step.get() - 2]

      findNextBox: () ->
        $ @findBoxes()[@step.get()]

      findBoxes: () ->
        @element.parents('form').find('.language-box')

      findPrevButton: () ->
        @element.siblings('.prev')

      findNextButton: () ->
        @element.siblings('.next')

      findSubmitButton: () ->
        @element.siblings("input[type='submit']")


    $('form .actions .next').bind 'click.nextLanguageBox', () -> steps.next $(this)

    $('form .actions .prev').bind 'click.prevLanguageBox', () -> steps.prev $(this)
      