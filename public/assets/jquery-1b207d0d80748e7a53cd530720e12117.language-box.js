(function(){var a;a=function(a){var b,c,d;return d=function(a,b){var d,e,f;d=a.element,e=d.caret(),d.val(e.replace(a.text)),f=c(e.end-e.text.length,0)+a.text.length,d.caret(f,f);if(b!=null)return b(d)},c=function(a,b){return a>=b?a:b},b=function(){function b(a,b){this.box=a,this.options=b,this.lang=this.box.attr("lang")||this.options.lang,this.useAutocomplete=typeof this.options.autocomplete=="object"&&this.options.autocomplete}return b.prototype.buildLayout=function(){this.addBoxAttributes();switch(this.options.layout){case"extended":this.buildExtendedStructure();break;case"compact":this.buildCompactStructure();break;default:a.error("Given type of layout is not supported.")}return this},b.prototype.addBoxAttributes=function(){return this.box.addClass("language-box").identify("language-box").css(this.boxDimensions())},b.prototype.boxDimensions=function(){var a;return a={height:this.options.height||this.options.layoutDimensions[this.options.layout].height,width:this.options.width||this.options.layoutDimensions[this.options.layout].width},a},b.prototype.buildExtendedStructure=function(){return this.buildVisibleMainBar(),this.buildInputField(),this.prepareLanguageMarker().appendTo(this.mainBar)},b.prototype.buildCompactStructure=function(){return this.buildHiddenMainBar(),this.buildInputField(),this.prepareLanguageMarker().appendTo(this.box)},b.prototype.buildVisibleMainBar=function(){return this.buildMainBar(),this.buildSpecialLetterList(),this},b.prototype.buildHiddenMainBar=function(){return this.buildMainBar(),this.mainBar.css({display:"none"}),this.buildSpecialLetterList(),this},b.prototype.buildMainBar=function(){return this.mainBar=a("<div></div>").addClass("main-bar").appendTo(this.box)},b.prototype.buildSpecialLetterList=function(){var b;return this.specialLetterList=a("<ul></ul>").addClass("special-letters").appendTo(this.mainBar),b=this,a.each(this.mergeAllLettersIntoOneList(),function(c,d){var e;return e=a("<li></li>").addClass("clickable").text(d).appendTo(b.specialLetterList)}),this},b.prototype.mergeAllLettersIntoOneList=function(){var b,c,d;return this.letters=a.merge([],((c=this.options.specialLetter.list[this.lang])!=null?c.small:void 0)||[]),b=a.merge([],((d=this.options.specialLetter.list[this.lang])!=null?d.capital:void 0)||[]),a.merge(this.letters,b)},b.prototype.prepareLanguageMarker=function(){return this.languageMarker=a("<div></div>").addClass("lang"),this.flag=a("<img />").addClass("flag").attr({src:""+this.options.imagesDirectory+"/flag-"+this.lang+".png",alt:"flag-"+this.lang}).appendTo(this.languageMarker),this.languageMarker},b.prototype.buildInputField=function(){var b,c;return c=this.options.inputFieldNameFormat.replace("LANG",this.lang),b=this.inputFieldCssParams(),this.options.layout==="extended"?this.inputField=a("<textarea></textarea>"):this.inputField=a("<input />").attr("type","text"),this.inputField.val(this.options.text).attr("name",c).css(b),this.options.placeholder!=null&&this.inputField.attr("placeholder",this.options.placeholder),this.inputField.appendTo(this.box),this},b.prototype.inputFieldCssParams=function(){var a,b,c,d,e;a=parseFloat(this.boxDimensions().height),b=parseFloat(this.boxDimensions().width);switch(this.options.layout){case"extended":c=a-58,e=b-6;break;case"compact":c=a-6,e=b-41}return c=c.toString()+"px",e=e.toString()+"px",d={minWidth:e,width:e,maxWidth:e,minHeight:c,height:c,maxHeight:c},d},b.prototype.setUpData=function(){return this.useAutocomplete&&a.data(this.inputField[0],"languageBox",{sourceUrl:this.options.sourceUrl,lang:this.lang,termMapper:this.options.termMapper}),this},b.prototype.bindEvents=function(){return this.bindSpecialLetterEvents(),this.bindInputFieldEvents()},b.prototype.bindSpecialLetterEvents=function(){var b;return b=this,this.specialLetterList.children("li").bind("click.languageBox.specialLetter",function(){return d({element:b.inputField,text:a(this).text()},function(){if(this.useAutocomplete)return b.inputField.autocomplete("search")})}),this},b.prototype.bindInputFieldEvents=function(){return this.bindFocusEvents(),this.bindHighlighting(),this.bindKeyCombinations()},b.prototype.bindFocusEvents=function(){return this.inputField.bind("focus.languageBox.inputField",function(){return a(this).parent().addClass("focus")}),this.inputField.bind("blur.languageBox.inputField",function(){return a(this).parent().removeClass("focus")}),this.inputField.bind("focus.languageBox.setPosition",function(){var b;return b=a(this).val().length,a(this).caret(b,b)}),this},b.prototype.bindHighlighting=function(){var a;return a=this,this.inputField.bind("keydown.languageBox.highlight","alt+b",function(b){return b.preventDefault(),d({element:a.inputField,text:"["+a.inputField.caret().text+"]"})}),this},b.prototype.bindKeyCombinations=function(){var a,b,c,d,e;this.prepareKeyCombinations(),b=this,e=this.combinations;for(c=0,d=e.length;c<d;c++)a=e[c],this.inputField.bind("keydown.languageBox.combinations",a,function(a){var c,d,e,f;a.preventDefault(),d=Number(a.data.match(/\d+$/)[0]),e=b.options.specialLetter,e.switcher.test(a.data)&&(d+=(((f=e.list[b.lang])!=null?f.small:void 0)||[]).length),c=b.inputField.siblings(".main-bar").find(".special-letters li:nth-child("+String(d)+")");if(c!=null){c.trigger("click.languageBox.specialLetter");if(e.clickCallback!=null)return e.clickCallback(c)}});return this},b.prototype.prepareKeyCombinations=function(){var a,b,c,d,e,f,g;b=this.options.combinationFormats,this.combinations=[],f=[b.small,b.capital],g=[];for(d=0,e=f.length;d<e;d++)a=f[d],g.push(function(){var b;b=[];for(c=1;c<=9;c++)b.push(this.combinations.push(a.replace("NUMBER",c)));return b}.call(this));return g},b.prototype.setUpAutocomplete=function(){return this.useAutocomplete&&this.inputField.autocomplete(a.extend({},this.options.autocomplete,{appendTo:"#"+this.box.attr("id")})),this},b}(),a.fn.languageBox=function(c){return c=a.extend({},a.fn.languageBox.defaults,c||{}),this.each(function(){var d;return d=new b(a(this),c),d.buildLayout().bindEvents().setUpData().setUpAutocomplete()})},a.fn.languageBox.defaults={combinationFormats:{small:"alt+NUMBER",capital:"alt+shift+NUMBER"},text:"",lang:"en",inputFieldNameFormat:"translations[LANG]",placeholder:null,width:null,height:null,layout:"extended",layoutDimensions:{extended:{width:"550px",height:"108px"},compact:{width:"550px",height:"21px"}},specialLetter:{switcher:/shift/,list:{en:{small:[],capital:[]},de:{small:["ä","ö","ü","ß"],capital:["Ä","Ö","Ü"]},pl:{small:["ą","ć","ę","ł","ń","ó","ś","ź","ż"],capital:["Ą","Ć","Ę","Ł","Ń","Ó","Ś","Ź","Ż"]}},clickCallback:function(a){return a.addClass("focus").delay(150).queue(function(){return a.removeClass("focus"),a.dequeue()})}},sourceUrl:"/",imagesDirectory:"/assets",termMapper:function(a){return a.replace(/\[|\]/g,"")},autocomplete:{minLength:2,open:function(b,c){var d;return a(this).addClass("with-prompts"),d=a(this).next(".ui-autocomplete.ui-menu"),d.removeAttr("style")},close:function(b,c){return a(this).removeClass("with-prompts")},focus:function(b,c){var d;return d=a(this).next(".ui-autocomplete.ui-menu"),d.children(".focus").removeClass("focus"),d.children(".ui-menu-item:has(.ui-state-hover)").addClass("focus")},source:function(b,c){var d,e,f;return e=this.element[0],d=a.data(e,"languageBox"),f=d.termMapper(a(e).val()),d.sourceUrl.length>0?a.getJSON(d.sourceUrl,{term:f,lang:d.lang},function(a){return c(a)}):[]}}}},a(jQuery)}).call(this)